<div class="main-container">
    <div class="banner-user">
        <img [src]="bannerUrl ?? '/assets/imagens/banner-trampo-generico.png'" alt="banner usuario">
    </div>
    <div class="header-container">
        <div class="user-info">
            <div class="user-photo">
                <img [src]="fotoUrl || '/assets/imagens/foto-perfil-generico.png'" alt="foto do usuario">  
            </div>
            <div class="user-details">
                <h2>{{ perfil?.nome || '—' }}</h2>

                <p class="cargo" *ngIf="perfil?.setor; else cargoPadrao">
                {{ categoriasDescricoes[perfil?.setor!] | titlecase }}
                </p>
                <ng-template #cargoPadrao>
                    <p class="cargo">{{getRoleUsuario() !== TipoUsuario.ADMIN ? "Profissional" : "Administrador"}}</p>
                </ng-template>

                <div class="rating">
                    <span class="score">
                        <span class="star">★</span>
                        {{ (mediaAvaliacoes || 0) | number:'1.1-1' }}/5
                    </span>
                </div>

            </div>
        </div>
        <div class="actions-user">
            <button class="btn-share">Compartilhar <img src="/assets/icones/share-icon.svg" alt="save icon"></button>
            <button *ngIf="isFavorito" (click)="abrirModalDesfavoritar()" class="btn-salvar"><img src="/assets/icones/saved-icon.svg" alt="saved icon"></button>
            <button *ngIf="!isFavorito" (click)="abrirModalFavoritar()" class="btn-salvar"><img src="/assets/icones/save-icon.svg" alt="save icon"></button>
            <button class="btn-contato">Contato</button>
            <button class="btn-orcamento">Solicitar Orçamento</button>
        </div>
    </div>
    <div class="video-view">
        <video
            *ngIf="videoUrl"
            [src]="videoUrl"
            controls
            playsinline
            preload="metadata"
            style="width:100%; height:auto; border-radius:12px; max-height:70vh;">
            Seu navegador não suporta vídeo HTML5.
        </video>
    </div>
    <div class="estatisticas-container">
        <div class="dual-grid-estatisticas">
            <img src="/assets/icones/servicos-realizados-icon.svg" alt="Serviços Realizados">
            <h3>{{"36"}} Serviços realizados</h3>
        </div>
        <div class="dual-grid-estatisticas">
            <img src="/assets/icones/tempo-medio-icon.svg" alt="Tempo Médio">
            <h3>Tempo médio de resposta: {{"1"}}h</h3>
        </div>
        <div class="dual-grid-estatisticas">
            <img src="/assets/icones/experiencia-icon.svg" alt="Experiência">
            <h3>{{perfil?.tempoExperiencia || "--"}} anos de experiência</h3>
        </div>
    </div>
    <div class="descricao-user">
        <div class="bio-user">
            <div class="desc-header">
                <h3>Profissional Bio</h3>
                <p *ngIf="perfil?.tempoExperiencia != null">
                {{ perfil?.tempoExperiencia }} anos de experiência
                </p>
            </div>
            <p>
                {{ perfil?.bio || 'Este profissional ainda não preencheu a bio.' }}
            </p>
        </div>
        <div class="skills-user">
            <div class="desc-header">
                <h3>Skills</h3>
            </div>
            <div class="skills-list" *ngIf="skillsLista.length; else semSkills">
                <p *ngFor="let s of skillsLista">{{ s }}</p>
            </div>

            <ng-template #semSkills>
                <div class="skills-list"><p>Sem skills cadastradas</p></div>
            </ng-template>
        </div>  
    </div>
    <div class="servicos-container">
        <h1 class="titulo">Serviços</h1>
        <div class="servicos-list" *ngIf="servicos.length > 0; else semServicos">
            <div class="servico-item" *ngFor="let servico of servicosPaginados">
                <div class="servico-item-header">
                    <img [src]="servico.bannerUrl || '/assets/imagens/imagens-de-exemplo/retangulo-cinza.png'"
                        alt="Serviço Icon">
                    <div class="item-details">
                        <h3>{{ servico.nome }}</h3>
                        <p>{{ servico.descricao }}</p>
                        <span class="preco">R$ {{ (servico.valor | number:'1.2-2') || 'Não definido.' }}</span>
                    </div>
                </div>
                <button id="btn-solicitar-orcamento" class="btn-contato">Solicitar Orçamento</button>
            </div>
        </div>


        <ng-template #semServicos>
            <div class="no-data-message">
                <img src="assets/icones/no-data-icon.svg" alt="Sem dados" />
                <p>Sem serviços cadastrados.</p>
            </div>
        </ng-template>

        
        <div class="paginacao">
            <app-pagination
                [paginaAtual]="paginaAtualServicos"
                [totalItens]="totalItensServicos"
                [itensPorPagina]="itensPorPaginaServicos"
                (paginaMudou)="onPaginaMudouServicos($event)">
            </app-pagination>
        </div>
    </div>

    <div class="comentarios-container">
        <div class="comentarios-header">
            <h1 class="titulo">Comentários</h1>
            <button class="btn-orcamento" id="btn-avaliar" (click)="abrirModalAvaliarProfissional()">
            Escreva uma avaliação
            </button>
        </div>

        <div class="comentarios-list" *ngIf="avaliacoesPaginadas.length; else semAvaliacoes">
            <article class="comentario-card" *ngFor="let a of avaliacoesPaginadas">
            <header class="comentario-header">
                <img
                [src]="a.clienteId && fotosClientes[a.clienteId] ? fotosClientes[a.clienteId] : '/assets/imagens/foto-perfil-generico.png'"
                [alt]="'Foto de ' + (a.clienteNome || 'cliente')"
                />                
                <div class="comentario-meta">
                <h4>
                    {{ a.clienteNome || 'Cliente' }}
                </h4>
                <div class="stars-e-data">
                    <div class="stars">
                    <span
                        *ngFor="let s of [1,2,3,4,5]; let i = index"
                        [class.filled]="i < (a.estrela || 0)"
                        >★</span
                    >
                    </div>
                    <small class="data">{{ getTempoDecorridoAvaliacao(a) }}</small>
                </div>
                </div>
            </header>

            <h3 class="comentario-titulo">{{ a.titulo || 'Avaliação do cliente' }}</h3>
            <p class="comentario-texto">{{ a.descricao }}</p>
            </article>
        </div>

        <ng-template #semAvaliacoes>
            <div class="no-data-message">
                <img src="assets/icones/no-data-icon.svg" alt="Sem dados" />
                <p>Este profissional ainda não possui avaliações.</p>
            </div>
        </ng-template>

        
        <div class="paginacao">
            <app-pagination
            [paginaAtual]="paginaAtualAvaliacoes"
            [totalItens]="totalItensAvaliacoes"
            [itensPorPagina]="itensPorPaginaAvaliacoes"
            (paginaMudou)="onPaginaMudouAvaliacoes($event)">
            </app-pagination>
        </div>
        
    </div>

    <!-- <div class="avalie-container">
        <h2>Avalie este profissional</h2>
        <button class="btn-orcamento" id="btn-avaliar" (click)="abrirModalAvaliarProfissional()">Escreva uma avaliação</button>
        <p>Compartilhe seus pensamentos com outros clientes</p>
    </div> -->

    <!-- <div class="avaliacoes-container">
        <h1 class="titulo">Avaliações de clientes</h1>
        <section class="dual-flex">
            <section class="avaliacoes-media-e-barra">
                <div class="media-avaliacoes">
                    <h3>4 de 5</h3>
                    <img src="/assets/imagens/imagens-de-exemplo/avaliacao-estrelas.png" alt="avaliação do usuário">
                    <p>500 avaliações</p>
                </div>
                <div class="barra-avaliacoes">
                    <p>5 estrelas <img src="/assets/imagens/imagens-de-exemplo/barra-vazia.png" alt="barra de avaliações"> {{"0%"}}</p>
                    <p>4 estrelas <img src="/assets/imagens/imagens-de-exemplo/barra-completa.png" alt="barra de avaliações"> {{"100%"}}</p>
                    <p>3 estrelas <img src="/assets/imagens/imagens-de-exemplo/barra-vazia.png" alt="barra de avaliações"> {{"0%"}}</p>
                    <p>2 estrelas <img src="/assets/imagens/imagens-de-exemplo/barra-vazia.png" alt="barra de avaliações"> {{"0%"}}</p>
                    <p>1 estrelas <img src="/assets/imagens/imagens-de-exemplo/barra-vazia.png" alt="barra de avaliações"> {{"0%"}}</p>
                </div>
            </section>

        </section>
    </div> -->
</div>


<ng-template #avaliacaoTemplate>
  <div class="avaliacao-modal">
    <div class="avaliacao-modal-section">
      <label class="avaliacao-modal-label">Como estava o serviço?</label>

    <div class="avaliacao-stars">
        <button
            type="button"
            *ngFor="let star of [1,2,3,4,5]"
            (click)="setAvaliacaoEstrelas(star)"
            (mouseenter)="onStarHover(star)"
            (mouseleave)="onStarLeave()"
            [class.filled]="star <= (starHover || avaliacaoEstrelas)"
        >
            ★
        </button>
    </div>

    </div>

    <div class="avaliacao-modal-section">
      <label class="avaliacao-modal-label">Dê um título à sua avaliação</label>
      <input
        type="text"
        [(ngModel)]="avaliacaoTitulo"
        placeholder="Digite um título para a avaliação">
    </div>

    <div class="avaliacao-modal-section">
      <label class="avaliacao-modal-label">Escrever uma avaliação</label>
      <textarea
        [(ngModel)]="avaliacaoTexto"
        placeholder="O que os outros clientes precisam saber?">
      </textarea>
    </div>

    <p class="avaliacao-erro" *ngIf="avaliacaoErro">
      {{ avaliacaoErro }}
    </p>
  </div>
</ng-template>

