<div class="main-container">
    <div class="banner-user">
        <img [src]="bannerUrl || '/assets/imagens/banner-trampo-generico.png'" alt="banner usuario">
    </div>
    <div class="header-container">
        <div class="user-info">
            <div class="user-photo">
                <img [src]="fotoUrl || '/assets/imagens/foto-perfil-generico.png'" alt="foto do usuario">            
            </div>
            <div class="user-details">
                <h2>{{ perfil?.nome || '—' }}</h2>

                <p class="cargo" *ngIf="perfil?.setor; else cargoPadrao">
                {{ categoriasDescricoes[perfil?.setor!] | titlecase }}
                </p>

                <ng-template #cargoPadrao>
                    <p class="cargo">{{getRoleUsuario() !== TipoUsuario.ADMIN ? "Profissional" : "Administrador"}}</p>
                </ng-template>

                <div class="rating">
                    <span class="score">
                        <span class="star">★</span>
                        {{ (mediaAvaliacoes || 0) | number : '1.1-1' }}/5
                    </span>
                </div>
            </div>
        </div>
        <div class="actions-user-col">
            <div class="mini-progress" aria-label="Progresso de destaque">
                <div class="mini-progress-header">
                    <span>Poder de Destaque </span>
                    <span>{{ userScore }} / {{ maxScore }} pts</span>
                </div>
                <div class="mini-progress-bar">
                    <div class="mini-progress-fill" [style.width.%]="progressPercent">
                        <!-- foguete ancorado no fim da barra -->
                        <div class="rocket" aria-hidden="true">
                            <svg viewBox="0 0 64 64" width="28" height="28">
                            <path d="M46 2c-7 2-15 9-20 15l-7 1-7 9 9-2 2 2-2 9 9-7 1-7C37 18 44 9 46 2z" fill="#ffffff"/>
                            <circle cx="40" cy="16" r="5" fill="#d6bfff"/>
                            <path d="M22 35l-8 8 9-2z" fill="#ffffff"/>
                            <path d="M35 22l-2 9 8-8z" fill="#ffffff"/>
                            </svg>
                            <span class="flame"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="actions-user profissional">
                <button class="btn-compartilhar" (click)="redirectToSitePublico()">Compartilhar Meu Mini-Site <img src="/assets/icones/share-mini-site-icon.svg" alt=""></button>
                <button class="btn-impulsionar" (click)="redirectToGameficacao()">Impulsionar Perfil <img src="/assets/icones/foguete-icon.svg" alt="icone foguete"></button>
                <button class="btn-editar-perfil" (click)="redirectToEditarSite()">Editar Perfil</button>
            </div>
        </div>
    </div>
    <div class="video-view">
        <video
            *ngIf="videoUrl"
            [src]="videoUrl"
            controls
            playsinline
            preload="metadata"
>
            Seu navegador não suporta vídeo HTML5.
        </video>
    </div>
    <div class="estatisticas-container">
        <div class="dual-grid-estatisticas">
            <img src="/assets/icones/servicos-realizados-icon.svg" alt="Serviços Realizados">
            <h3>{{"36"}} Serviços realizados</h3>
        </div>
        <div class="dual-grid-estatisticas">
            <img src="/assets/icones/tempo-medio-icon.svg" alt="Tempo Médio">
            <h3>Tempo médio de resposta: {{"1"}}h</h3>
        </div>
        <div class="dual-grid-estatisticas">
            <img src="/assets/icones/experiencia-icon.svg" alt="Experiência">
            <h3>{{perfil?.tempoExperiencia || "--"}} anos de experiência</h3>
        </div>
    </div>
    <div class="descricao-user">
        <div class="bio-user">
            <div class="desc-header">
                <h3>Profissional Bio</h3>
                <p *ngIf="perfil?.tempoExperiencia != null">
                {{ perfil?.tempoExperiencia }} anos de experiência
                </p>
            </div>
            <p>
                {{ perfil?.bio || 'Este profissional ainda não preencheu a bio.' }}
            </p>
        </div>
        <div class="skills-user">
            <div class="desc-header">
                <h3>Skills</h3>
            </div>
            <div class="skills-list" *ngIf="skillsLista.length; else semSkills">
                <p *ngFor="let s of skillsLista">{{ s }}</p>
            </div>

            <ng-template #semSkills>
                <div class="skills-list"><p>Sem skills cadastradas</p></div>
            </ng-template>
        </div>  
    </div>

    <div class="servicos-container">
        <h1 class="titulo">Serviços</h1>
        <div class="servicos-list" *ngIf="servicos.length > 0; else semServicos">
            <div class="servico-item" *ngFor="let servico of servicosPaginados">
                <div class="servico-item-header">
                    <img [src]="servico.bannerUrl || '/assets/imagens/imagens-de-exemplo/retangulo-cinza.png'"
                        alt="Serviço Icon">
                    <div class="item-details">
                        <h3>{{ servico.nome }}</h3>
                        <p>{{ servico.descricao }}</p>
                        <span class="preco">R$ {{ (servico.valor | number:'1.2-2') || 'Não definido.' }}</span>
                    </div>
                </div>
                <button id="btn-solicitar-orcamento" class="btn-contato">Solicitar Orçamento</button>
            </div>
        </div>

        <ng-template #semServicos>
            <div class="no-data-message">
                <img src="assets/icones/no-data-icon.svg" alt="Sem dados" />
                <p>Sem serviços cadastrados.</p>
            </div>
        </ng-template>


        <div class="paginacao">
            <app-pagination
                [paginaAtual]="paginaAtualServicos"
                [totalItens]="totalItensServicos"
                [itensPorPagina]="itensPorPaginaServicos"
                (paginaMudou)="onPaginaMudouServicos($event)">
            </app-pagination>
        </div>
    </div>


    <div class="comentarios-container">
        <h1 class="titulo">Comentários</h1>

        <div class="comentarios-list" *ngIf="avaliacoesPaginadas.length; else semAvaliacoes">
            <article class="comentario-card" *ngFor="let a of avaliacoesPaginadas">
             <header class="comentario-header">
                <img
                [src]="a.clienteId && fotosClientes[a.clienteId]
                    ? fotosClientes[a.clienteId]
                    : '/assets/imagens/foto-perfil-generico.png'"
                [alt]="'Foto de ' + (a.clienteNome || 'cliente')"
                />
            <div class="comentario-meta">
                <h4>
                {{ a.clienteNome || 'Cliente' }}
                </h4>
                <div class="stars-e-data">
                <div class="stars">
                    <span
                    *ngFor="let s of [1, 2, 3, 4, 5]; let i = index"
                    [class.filled]="i < (a.estrela || 0)"
                    >★</span
                    >
                </div>
                <small class="data">{{ getTempoDecorridoAvaliacao(a) }}</small>
                </div>
            </div>
            </header>

            <h3 class="comentario-titulo">{{ a.titulo || 'Avaliação do cliente' }}</h3>
            <p class="comentario-texto">{{ a.descricao }}</p>
        </article>
        </div>

        <ng-template #semAvaliacoes>
        <div class="no-data-message">
            <img src="assets/icones/no-data-icon.svg" alt="Sem dados" />
            <p>Você ainda não recebeu avaliações.</p>
        </div>
        </ng-template>

        <div class="paginacao">
            <app-pagination
                [paginaAtual]="paginaAtualAvaliacoes"
                [totalItens]="totalItensAvaliacoes"
                [itensPorPagina]="itensPorPaginaAvaliacoes"
                (paginaMudou)="onPaginaMudouAvaliacoes($event)"
            >
            </app-pagination>
        </div>
    </div>


    <!-- <div class="avaliacoes-container">
        <h1 class="titulo">Avaliações de clientes</h1>
        <section class="dual-flex">
            <section class="avaliacoes-media-e-barra">
                <div class="media-avaliacoes">
                    <h3>4 de 5</h3>
                    <img src="/assets/imagens/imagens-de-exemplo/avaliacao-estrelas.png" alt="avaliação do usuário">
                    <p>500 avaliações</p>
                </div>
                <div class="barra-avaliacoes">
                    <p>5 estrelas <img src="/assets/imagens/imagens-de-exemplo/barra-vazia.png" alt="barra de avaliações"> {{"0%"}}</p>
                    <p>4 estrelas <img src="/assets/imagens/imagens-de-exemplo/barra-completa.png" alt="barra de avaliações"> {{"100%"}}</p>
                    <p>3 estrelas <img src="/assets/imagens/imagens-de-exemplo/barra-vazia.png" alt="barra de avaliações"> {{"0%"}}</p>
                    <p>2 estrelas <img src="/assets/imagens/imagens-de-exemplo/barra-vazia.png" alt="barra de avaliações"> {{"0%"}}</p>
                    <p>1 estrelas <img src="/assets/imagens/imagens-de-exemplo/barra-vazia.png" alt="barra de avaliações"> {{"0%"}}</p>
                </div>
            </section>
            <div class="avalie-container">
                <h2>Avalie este profissional</h2>
                <button class="btn-orcamento" id="btn-avaliar">Escreva uma avaliação</button>
                <p>Compartilhe seus pensamentos com outros clientes</p>
            </div>
        </section>
    </div> -->

    <!-- <div class="principais-avaliacoes">
        <h1 class="titulo">Principais Avaliações</h1>
        <div class="avaliacoes-list">
            <div class="avaliacao-item" *ngFor="let avaliacao of avaliacoesPaginadas">
                <div class="avaliacao-header">
                    <img [src]="avaliacao.foto" alt="Foto do usuário">
                    <h3>{{ avaliacao.nome }}</h3>
                </div>
                <img src="/assets/imagens/imagens-de-exemplo/avaliacao-estrelas.png" alt="avaliação do usuário">
                <p>Avaliado no Brasil em 22 de maio de 2025</p>
                <h3 id="avaliacao-titulo">{{avaliacao.titulo}}</h3>
                <h3 id="avaliacao-descricao">{{avaliacao.descricao}}</h3>
            </div>
        </div>
        <div class="paginacao">
            <app-pagination
                [paginaAtual]="paginaAtualAvaliacoes"
                [totalItens]="totalItensAvaliacoes"
                [itensPorPagina]="itensPorPaginaAvaliacoes"
                (paginaMudou)="onPaginaMudouAvaliacoes($event)">
            </app-pagination>
        </div>
    </div> -->

</div>
